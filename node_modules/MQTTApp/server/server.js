function server(){
var mqtt = require('mqtt');
var client = mqtt.connect('mqtt://broker.hivemq.com:1883');
var nano = require('nano')('http://localhost:5984');
var test_db = nano.db.use('rank_ed');
var sleep =require('sleep');
test_db.view('level',
                        'level', 
                                {'include_docs':false}, 
                        function(err,body){
                        if(!err){
                             var rows = body.rows;
                             var i=body.rows.length;
                                             while (i>0){
                                                        console.log(JSON.stringify(body.rows[i-1].value, null,4));
                                                        client.publish('rank_ed',JSON.stringify(body.rows[i-1].value));
                                                        i=i-1;
                                                    }
                                }
                                           }
                        );
sleep.sleep(30);
}
var infiniteloop=require('infinite-loop');
var loop=new infiniteloop();
loop.add(server);
loop.run();