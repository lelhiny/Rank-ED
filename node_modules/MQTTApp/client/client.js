var mqtt = require('mqtt');
var client = mqtt.connect('mqtt://broker.hivemq.com:1883');

var nano = require('nano')('http://localhost:5984');
var test_db = nano.db.use('ranked');

client.subscribe('rank_ed');                                        
client.handleMessage = function(packet, done){

	var doc = packet.payload.toString();
	var doc1  = `{"_id":"AUSEB02-036","_rev":"10-81e70b6dff727b775da2e06076358b5f
.48","School":"AUS","Privacy":"School","Value":0,"SenseTopic":"t
"EB02-036","time":"20160504082648","Display":"Bar","Unit":"C"}`;

	var obj = JSON.parse(doc);

//console.log(obj);

	var data = { Average: obj.Average,School: obj.School,Privacy: obj.Privacy,Value:obj.Value,SenseTopic: obj.SenseTopic,Location:
obj.Location,time: obj.time,Display: obj.Display,Unit:obj.Unit};
	
console.log(data);


	test_db.insert(data);

        console.log(packet.payload.toString());

        done();

}
